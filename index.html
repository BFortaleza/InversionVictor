import React, { useRef, useState } from 'react';
import { 
  Smartphone, Monitor, Lock, User, 
  CheckCircle, AlertTriangle, 
  Printer, Shield, Key, Wifi, Download
} from 'lucide-react';

// Renombramos el componente principal a App para seguir la convenci√≥n.
const App = () => {
  const printRef = useRef(null);
  const [isGenerating, setIsGenerating] = useState(false);

  /**
   * Cargar librer√≠as para generaci√≥n directa de PDF (Alternativa a window.print)
   * NOTA: Es crucial que estas librer√≠as est√©n disponibles globalmente (window.html2canvas, window.jspdf)
   * Se cargan usando etiquetas <script> dentro del JSX.
   */
  const loadScripts = (
    <>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    </>
  );

  /**
   * Maneja la descarga directa de PDF utilizando html2canvas y jspdf.
   * Garantiza que todo el contenido se capture y se genere en m√∫ltiples p√°ginas
   * si es necesario, en tama√±o Carta.
   */
  const handleDownloadPDF = async () => {
    if (typeof window.html2canvas === 'undefined' || typeof window.jspdf === 'undefined') {
      alert("Error: Las librer√≠as de generaci√≥n de PDF no se han cargado correctamente.");
      return;
    }

    setIsGenerating(true);
    const input = printRef.current;

    try {
      // 1. Capturar todo el contenido como un canvas (imagen grande)
      const canvas = await window.html2canvas(input, {
          scale: 2, // Mejor resoluci√≥n
          useCORS: true,
          allowTaint: true,
          scrollX: 0,
          scrollY: 0,
          windowWidth: input.scrollWidth,
          windowHeight: input.scrollHeight
      });

      const imgData = canvas.toDataURL('image/jpeg', 1.0);
      
      // 2. Inicializar PDF (Tama√±o Carta - 'letter')
      const pdf = new window.jspdf.jsPDF('p', 'mm', 'letter'); 
      
      const imgWidth = 215.9; // Ancho Carta en mm (8.5 inches)
      const pageHeight = 279.4; // Altura Carta en mm (11 inches)
      
      // Calcular la altura total de la imagen en mm
      const imgHeight = canvas.height * imgWidth / canvas.width;
      let heightLeft = imgHeight;
      let position = 0;

      // 3. A√±adir imagen al PDF, manejando m√∫ltiples p√°ginas
      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;

      // Recorre el resto de la imagen y a√±ade p√°ginas nuevas
      while (heightLeft >= -1) { 
          position = heightLeft - imgHeight;
          pdf.addPage();
          pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
      }
      
      // 4. Guardar el archivo
      pdf.save('Guia_Activacion_Banca_Internet.pdf');
    } catch (error) {
      console.error("Error al generar el PDF:", error);
      // Usar un m√©todo alternativo de alerta que no sea window.alert
      // En este caso, simplemente logueamos el error.
    } finally {
      setIsGenerating(false);
    }
  };

  return (
    <div className="min-h-screen bg-[#F0F4F8] font-sans text-slate-800 selection:bg-indigo-100 pb-20 print:bg-white print:pb-0">
      
      {/* 1. CARGA DE LIBRER√çAS DE PDF */}
      {loadScripts}

      {/* Estilos para impresi√≥n y fuentes personalizadas. Incluidos en el archivo √∫nico. */}
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Media query para impresi√≥n */
        @media print {
          /* Ajustes de tama√±o Carta */
          @page { 
            margin: 0.5cm !important; 
            size: letter portrait; 
          }
          
          /* CR√çTICO: Asegura que el cuerpo completo del documento se imprima */
          body, .min-h-screen, main, #print-content { 
            min-height: initial !important; 
            height: auto !important; 
            overflow: visible !important;
            padding: 0 !important;
            margin: 0 !important; 
            background: white; 
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact; 
          }

          .pb-20 { padding-bottom: 0 !important; }
          /* Oculta el bot√≥n de impresi√≥n y otros elementos innecesarios */
          .no-print { display: none !important; }
          /* Asegura que los pasos no se corten entre p√°ginas */
          .print-break-inside { break-inside: avoid !important; }
          /* Elimina sombras para impresi√≥n limpia */
          .shadow-xl, .shadow-lg, .shadow-md, .shadow-sm { box-shadow: none !important; border: 1px solid #eee; }
        }

        /* Animaciones para el header (ya exist√≠an) */
        @keyframes blob {
          0%, 100% { transform: translate(0, 0) scale(1); }
          33% { transform: translate(30px, -50px) scale(1.1); }
          66% { transform: translate(-20px, 20px) scale(0.9); }
        }
        .animate-blob { animation: blob 7s infinite; }
        .animation-delay-2000 { animation-delay: 2s; }
      `}</style>

      {/* El contenido completo que queremos capturar en el PDF se envuelve en este div con ref */}
      <div id="print-content" ref={printRef}>

        {/* --- HERO HEADER (COLOR CLARO) --- */}
        <header className="bg-blue-50 text-slate-900 pt-20 pb-24 relative overflow-hidden shadow-lg print:pt-10 print:pb-10 print:shadow-none print:bg-white">
          {/* Decoraci√≥n de fondo */}
          <div className="absolute top-0 right-0 w-96 h-96 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-blob"></div>
          <div className="absolute bottom-0 left-0 w-96 h-96 bg-cyan-400 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-blob animation-delay-2000"></div>
          
          <div className="max-w-4xl mx-auto px-6 relative z-10 text-center">
            {/* Badge ajustado para fondo azul claro */}
            <div className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-cyan-300 bg-cyan-100 backdrop-blur-sm text-cyan-800 text-xs font-bold tracking-widest uppercase mb-6">
              <Wifi size={12} /> Gu√≠a Oficial ‚Ä¢ Banco Uni√≥n
            </div>
            <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight mb-4 leading-tight text-slate-900">
              Activar Banca <br className="md:hidden"/> por Internet
            </h1>
            <div className="w-24 h-1 bg-gradient-to-r from-cyan-600 to-blue-700 mx-auto rounded-full mb-6"></div>
            {/* P√°rrafo ajustado para fondo azul claro */}
            <p className="text-slate-700 text-lg font-light max-w-xl mx-auto">
              Sigue los pasos en orden para configurar tu acceso seguro UNIM√ìVIL Plus.
            </p>
          </div>
        </header>

        <main className="max-w-4xl mx-auto px-6 -mt-16 relative z-20">
          
          {/* --- PREREQUISITES CARD --- */}
          <div className="bg-white/90 backdrop-blur-xl rounded-2xl shadow-xl p-8 mb-12 border-t-4 border-cyan-400 print:shadow-none print:border">
            <div className="flex flex-col md:flex-row gap-6 items-start">
              <div className="bg-cyan-50 p-4 rounded-xl text-cyan-700 shrink-0">
                <AlertTriangle size={32} strokeWidth={1.5} />
              </div>
              <div className="flex-1">
                <h3 className="text-lg font-bold text-slate-900 mb-4 tracking-tight uppercase">üõë Antes de empezar</h3>
                <p className="text-slate-600 mb-6">Aseg√∫rate de tener a mano la siguiente informaci√≥n cr√≠tica:</p>
                
                <div className="grid md:grid-cols-2 gap-4">
                  <div className="group p-5 bg-slate-50 hover:bg-white rounded-xl border border-slate-200 hover:border-cyan-300 transition-all duration-300">
                    <div className="flex items-center gap-3 mb-2">
                      <User size={18} className="text-cyan-600" />
                      <span className="font-bold text-slate-900 text-sm">Usuario (Num√©rico)</span>
                    </div>
                    <div className="text-sm text-slate-500 pl-8">
                      Revisa tu <span className="font-semibold text-cyan-700 bg-cyan-50 px-1 rounded">Correo Electr√≥nico</span>
                    </div>
                  </div>

                  <div className="group p-5 bg-slate-50 hover:bg-white rounded-xl border border-slate-200 hover:border-cyan-300 transition-all duration-300">
                    <div className="flex items-center gap-3 mb-2">
                      <Key size={18} className="text-cyan-600" />
                      <span className="font-bold text-slate-900 text-sm">Contrase√±a (4 n√∫meros)</span>
                    </div>
                    <div className="text-sm text-slate-500 pl-8">
                      Revisa tus <span className="font-semibold text-cyan-700 bg-cyan-50 px-1 rounded">SMS</span> del celular
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* --- PART 1 --- */}
          <SectionHeader 
            icon={<Monitor size={24} />} 
            title="PARTE 1: En el Navegador" 
            subtitle="Configuraci√≥n inicial de seguridad"
          />

          <div className="space-y-6 mb-16">
            
            {/* Paso 1 */}
            <StepCard number="01" title="Entrar a la web">
              <ul className="space-y-3">
                <ListItem text="Escribe en el buscador el portal oficial de banca por internet." />
                <ListItem text="Entra a la primera opci√≥n." />
              </ul>
            </StepCard>

            {/* Paso 2 */}
            <StepCard number="02" title="Poner tus datos">
              <ul className="space-y-3">
                <ListItem text={<>En <strong>Usuario</strong>, escribe el n√∫mero de tu correo.</>} />
                <ListItem text={<>Copia las letras y n√∫meros de la imagen (c√≥digo captcha). Clic en <strong>Iniciar Sesi√≥n</strong>.</>} />
                <ListItem text={<>Escribe la <strong>clave de 4 n√∫meros</strong> de tu SMS. Clic en <strong>Iniciar Sesi√≥n</strong>.</>} />
              </ul>
            </StepCard>

            {/* Paso 3 */}
            <StepCard number="03" title="Crear nueva Clave">
              <div className="space-y-4">
                
                {/* ACCI√ìN 1: Ingresar clave SMS */}
                <ul className="space-y-3">
                  <ListItem text={<>Escribe la <strong>clave de 4 n√∫meros</strong> de tu SMS.</>} />
                </ul>

                {/* √âNFASIS ESPECIAL SOLICITADO - CONTRASE√ëA NUEVA */}
                <div className="bg-red-50 text-red-900 p-5 rounded-xl ml-2 shadow-md my-5 relative overflow-hidden border-2 border-red-100 print:bg-white print:text-black print:border-slate-300">
                  {/* Background Icon */}
                  <div className="absolute top-0 right-0 p-4 opacity-10 text-red-600">
                    <Lock size={64} /> 
                  </div>
                  {/* Content */}
                  <div className="relative z-10 flex gap-4 items-center">
                    {/* Foreground Icon */}
                    <div className="bg-white p-2 rounded-lg shadow-sm border border-red-100 text-red-500">
                      <Lock size={24} />
                    </div>
                    <p className="text-sm font-medium leading-relaxed">
                      <span className="text-red-600 font-bold text-base">Requisito de Seguridad:</span> <br className='sm:hidden'/>
                      Escribe tu <strong>nueva clave</strong> dos veces. <br/>
                      <span className="text-red-700/80 text-xs">(M√≠nimo 10 caracteres, may√∫sculas, min√∫sculas, n√∫meros, signos. Ej: Maria.2024)</span>
                    </p>
                  </div>
                </div>


                {/* ACCI√ìN 2: C√≥digo de 6 n√∫meros */}
                <ul className="space-y-3">
                  <ListItem text={<>Escribe el <strong>c√≥digo de 6 n√∫meros</strong> que lleg√≥ por SMS. Clic en <strong>Continuar</strong>.</>} />
                </ul>
                
                <div className="flex items-center gap-3 bg-rose-50 px-4 py-3 rounded-lg border border-rose-100 text-rose-800 text-sm font-medium">
                  <AlertTriangle size={16} />
                  Aparecer√°n las opciones "Registrar" y "Salir", elige "Salir" dos veces.
                </div>
              </div>
            </StepCard>

            {/* Paso 4 */}
            <StepCard number="04" title="Personalizaci√≥n de Usuario">
              <ul className="space-y-3 mb-4">
                <ListItem text={<>Vuelve a ingresar el <strong>Usuario</strong> enviado a tu correo.</>} />
                <ListItem text={<>Copia las letras y n√∫meros de la imagen (c√≥digo captcha). Clic en <strong>Iniciar Sesi√≥n</strong>.</>} />
                <ListItem text={<>Introduce la <strong>clave modificada</strong> en el Paso 3. Clic en <strong>Iniciar Sesi√≥n</strong>.</>} />
              </ul>

                {/* √âNFASIS ESPECIAL SOLICITADO - NUEVO USUARIO */}
                <div className="bg-red-50 text-red-900 p-5 rounded-xl ml-2 shadow-md my-5 relative overflow-hidden border-2 border-red-100 print:bg-white print:text-black print:border-slate-300">
                  <div className="absolute top-0 right-0 p-4 opacity-10 text-red-600">
                    <User size={64} />
                  </div>
                  <div className="relative z-10 flex gap-4 items-center">
                    <div className="bg-white p-2 rounded-lg shadow-sm border border-red-100 text-red-500">
                      <Shield size={24} />
                    </div>
                    <p className="text-sm font-medium leading-relaxed">
                      Introduce un <span className="text-red-600 font-bold text-base">nuevo usuario</span> con letras y n√∫meros <br/>
                      <span className="text-red-700/80 text-xs">(m√≠nimo 7 caracteres)</span>, y clic en <strong>Validar</strong>.
                    </p>
                  </div>
                </div>

              <ul className="space-y-3">
                <ListItem text={<>Elige una imagen y escribe una frase. Clic en <strong>Continuar</strong>.</>} />
                <ListItem text={<><strong>Clave transaccional:</strong> Escribe el c√≥digo de 6 d√≠gitos que te lleg√≥ por SMS, clic en <strong>Continuar</strong>.</>} />
              </ul>

              <div className="mt-4 flex items-center gap-3 bg-rose-50 px-4 py-3 rounded-lg border border-rose-100 text-rose-800 text-sm font-medium">
                  <AlertTriangle size={16} />
                  Aparecer√°n las opciones "Registrar" y "Salir", elige "Salir" dos veces.
              </div>

              <div className="mt-6 text-center">
                <span className="inline-block bg-emerald-100 text-emerald-800 text-xs font-bold px-3 py-1 rounded-full border border-emerald-200">
                  ¬°LISTO! Cierra la p√°gina web.
                </span>
              </div>
            </StepCard>

          </div>


          {/* --- PART 2 --- */}
          <div className="print-break-inside">
            <SectionHeader 
              icon={<Smartphone size={24} />} 
              title="PARTE 2: En la Aplicaci√≥n" 
              subtitle="UNIM√ìVIL PLUS (Celular)"
            />

            <div className="grid md:grid-cols-3 gap-6 mb-12">
              
              <AppCard number="5" title="Descargar">
                <p className="text-sm text-slate-600 mb-2">Busca <strong>UNIM√≥vil Plus</strong> en la tienda de tu celular (Play Store).</p>
                <div className="bg-slate-100 p-2 rounded text-xs text-center text-slate-500 font-mono">Instala y abre</div>
              </AppCard>

              <AppCard number="6" title="Ingresar">
                <ul className="text-sm text-slate-600 space-y-2">
                  <li>Pon tu <strong>NUEVO USUARIO</strong>.</li>
                  <li>Pon tu <strong>NUEVA CONTRASE√ëA</strong>.</li>
                  <li className="flex items-center gap-2 bg-blue-50 p-1.5 rounded text-blue-800 text-xs font-medium">
                    <CheckCircle size={12}/> Tickear la imagen
                  </li>
                  <li>Clic <strong>Iniciar Sesi√≥n</strong>.</li>
                </ul>
              </AppCard>

              <AppCard number="7" title="Registrar">
                <ul className="text-sm text-slate-600 space-y-2">
                  <li>Presiona <strong>REGISTRAR</strong> y luego <strong>FINALIZAR</strong>.</li>
                  <li>Toca <strong>"Solicitar token"</strong>.</li>
                  <li>Pon el c√≥digo SMS y presiona <strong>CONFIRMAR</strong>.</li>
                  <li>Clic en <strong>Cerrar</strong>.</li>
                </ul>
              </AppCard>

            </div>
          </div>

          {/* --- SUCCESS FOOTER --- */}
          <div className="bg-blue-100 rounded-2xl p-8 md:p-12 text-center text-slate-900 relative overflow-hidden shadow-2xl print:bg-white print:text-black print:border print:shadow-none">
            <div className="relative z-10">
              <div className="inline-flex p-3 bg-cyan-500/20 rounded-full text-cyan-700 mb-4 border border-cyan-500/30">
                <CheckCircle size={32} />
              </div>
              <h2 className="text-2xl font-bold mb-2">Actualizaci√≥n de Token Exitoso</h2>
              <p className="text-slate-600">¬°FELICIDADES! Ya puedes usar tu banca m√≥vil.</p>
            </div>
          </div>

          {/* --- NUEVA UBICACI√ìN DEL BOT√ìN DE DESCARGA (AL FINAL DE LA P√ÅGINA) --- */}
          <div className="py-12 flex justify-center no-print">
            <button 
              onClick={handleDownloadPDF}
              disabled={isGenerating}
              className="group relative inline-flex items-center justify-center px-8 py-3 font-semibold text-white transition-all duration-200 bg-emerald-600 rounded-full hover:bg-emerald-700 hover:shadow-lg hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isGenerating ? (
                <>
                  <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Generando PDF...
                </>
              ) : (
                <>
                  <Download size={18} className="mr-2 group-hover:scale-110 transition-transform" />
                  Descargar Gu√≠a Completa en PDF
                </>
              )}
            </button>
          </div>

        </main>
      </div> {/* Cierre del div ref={printRef} */}
    </div>
  );
};

// --- Componentes Est√©ticos Auxiliares ---
// (No se modifican para cumplir con la restricci√≥n)

const SectionHeader = ({ icon, title, subtitle }) => (
  <div className="flex items-start gap-4 mb-8 border-b border-slate-200 pb-4 print-break-inside">
    <div className="bg-cyan-100 p-3 rounded-xl text-cyan-800 shadow-sm print:bg-slate-100">
      {icon}
    </div>
    <div>
      <h2 className="text-2xl font-bold text-slate-900 tracking-tight">{title}</h2>
      <p className="text-slate-500 text-sm uppercase tracking-wider font-medium mt-1">{subtitle}</p>
    </div>
  </div>
);

const StepCard = ({ number, title, children }) => (
  <div className="group bg-white rounded-xl p-6 shadow-sm border border-slate-100 hover:shadow-md hover:border-cyan-200 transition-all duration-300 print-break-inside print:shadow-none print:border-slate-300">
    <div className="flex items-center gap-4 mb-6">
      <div className="flex items-center justify-center w-10 h-10 rounded-full bg-slate-900 text-white font-bold text-lg shadow-lg shadow-cyan-500/20 group-hover:scale-110 transition-transform">
        {number}
      </div>
      <h3 className="text-xl font-bold text-slate-800">{title}</h3>
    </div>
    <div className="pl-4 md:pl-14 border-l-2 border-slate-100 group-hover:border-cyan-100 transition-colors">
      {children}
    </div>
  </div>
);

const AppCard = ({ number, title, children }) => (
  <div className="bg-white rounded-xl p-6 shadow-sm border border-slate-100 relative overflow-hidden group hover:-translate-y-1 transition-all duration-300 print-break-inside print:shadow-none print:border-slate-300">
    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-300 to-blue-500 transform origin-left scale-x-0 group-hover:scale-x-100 transition-transform duration-300"></div>
    <div className="flex justify-between items-center mb-4">
      <h4 className="font-bold text-lg text-slate-800">{title}</h4>
      <span className="text-slate-200 text-4xl font-black opacity-50 select-none">{number}</span>
    </div>
    {children}
  </div>
);

const ListItem = ({ text }) => (
  <li className="flex items-start gap-3 text-sm text-slate-600 leading-relaxed group-hover:text-slate-700">
    <span className="mt-1.5 w-1.5 h-1.5 rounded-full bg-cyan-400 shrink-0"></span>
    <span>{text}</span>
  </li>
);

export default App;

