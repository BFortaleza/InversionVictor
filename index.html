<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco Fortaleza | Simulador & Solicitud</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        display: ['Poppins', 'sans-serif']
                    },
                    colors: {
                        brand: {
                            navy: '#002855',
                            blue: '#004B87',
                            orange: '#FF6B00',
                            light: '#F8FAFC',
                            gray: '#64748B',
                            ivory: '#FDFDFD' 
                        }
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(0, 40, 85, 0.08)',
                        'floating': '0 25px 50px -12px rgba(0, 0, 0, 0.15)',
                        'glow': '0 0 20px rgba(255, 107, 0, 0.3)',
                        'inner-light': 'inset 0 2px 4px 0 rgba(255, 255, 255, 0.3)'
                    },
                    animation: {
                        'slide-down': 'slideDown 0.4s ease-out forwards',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'pulse-slow': 'pulse 3s infinite',
                        'shine': 'shine 3s infinite'
                    },
                    keyframes: {
                        slideDown: { '0%': { opacity: '0', transform: 'translateY(-10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        shine: { '0%': { backgroundPosition: '200% center' }, '100%': { backgroundPosition: '-200% center' } }
                    }
                }
            }
        }
    </script>

    <style>
        /* Fondo Blanco Elegante con luz ambiental sutil */
        body { 
            background-color: #FDFDFD;
            background-image: radial-gradient(circle at 15% 10%, rgba(0, 75, 135, 0.03) 0%, transparent 40%),
                              radial-gradient(circle at 85% 90%, rgba(255, 107, 0, 0.03) 0%, transparent 40%);
            background-attachment: fixed;
        }
        
        /* --- SLIDERS CORREGIDOS --- */
        input[type=range] { 
            -webkit-appearance: none; /* Necesario para customizar */
            width: 100%; 
            background: transparent; /* Fondo transparente del input general */
            margin: 10px 0;
        }
        
        /* La línea (Track) - Chrome/Safari/Edge */
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; 
            height: 8px; 
            background: #94A3B8; /* GRIS VISIBLE */
            border-radius: 99px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
            cursor: pointer;
            border: none;
        }
        
        /* La línea (Track) - Firefox */
        input[type=range]::-moz-range-track {
            width: 100%; 
            height: 8px; 
            background: #94A3B8; /* GRIS VISIBLE */
            border-radius: 99px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
            cursor: pointer;
            border: none;
        }

        /* El botón (Thumb) - Chrome/Safari/Edge */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; 
            height: 32px; 
            width: 32px; 
            border-radius: 50%;
            background: white; 
            border: 4px solid #FF6B00; 
            box-shadow: 0 4px 10px rgba(255, 107, 0, 0.4); 
            cursor: pointer; 
            margin-top: -12px; /* Centrado vertical respecto al track de 8px: (8 - 32) / 2 = -12 */
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* El botón (Thumb) - Firefox */
        input[type=range]::-moz-range-thumb {
            height: 32px; 
            width: 32px; 
            border-radius: 50%;
            background: white; 
            border: 4px solid #FF6B00; 
            box-shadow: 0 4px 10px rgba(255, 107, 0, 0.4); 
            cursor: pointer; 
            border: none; /* Reset border for firefox specific quirk */
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        input[type=range]:hover::-webkit-slider-thumb { transform: scale(1.2); }
        input[type=range]:hover::-moz-range-thumb { transform: scale(1.2); }

        /* --- BOTONES --- */
        .module-btn { transition: all 0.3s ease; opacity: 0.7; transform: scale(0.98); }
        .module-btn:hover { opacity: 1; transform: scale(1); }
        .module-btn.active { 
            opacity: 1; transform: scale(1); 
            background: white; 
            box-shadow: 0 20px 40px -10px rgba(0, 40, 85, 0.12); 
            border: 1px solid rgba(255, 107, 0, 0.2);
        }
        .module-btn.active .icon-container { background: #FF6B00; color: white; box-shadow: 0 10px 20px -5px rgba(255, 107, 0, 0.4); }

        /* Botones de Producto (Pills) */
        .product-pill { transition: all 0.2s; border: 1px solid #E2E8F0; background: white; }
        .product-pill:hover { border-color: #94A3B8; transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .product-pill.active { 
            background: #002855; color: white; border-color: #002855; 
            box-shadow: 0 10px 25px -5px rgba(0, 40, 85, 0.3); 
            transform: scale(1.05); 
        }

        /* Efecto Destello en Botón Principal - NARANJA */
        .btn-shine {
            background-size: 200% auto;
            background-image: linear-gradient(to right, #FF6B00 0%, #FF9500 51%, #FF6B00 100%);
            transition: 0.5s;
            color: white;
        }
        .btn-shine:hover { 
            background-position: right center; 
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.6);
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col items-center pt-8 pb-12 px-4 font-sans text-slate-800">

    <!-- HEADER -->
    <header class="mb-8 text-center animate-fade-in relative z-10">
        <div class="inline-flex items-center gap-3 bg-white/80 backdrop-blur-md px-8 py-3 rounded-full shadow-soft mb-6 border border-white">
            <i class="fa-solid fa-building-columns text-2xl text-brand-orange"></i>
            <span class="font-display font-bold text-brand-navy tracking-tight text-xl">BANCO FORTALEZA</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-display font-bold text-brand-navy mb-2 tracking-tight">Tu meta, nuestro plan.</h1>
        <p class="text-slate-500 font-light text-lg">Simula y solicita tu producto ideal.</p>
    </header>

    <!-- CONTENEDOR PRINCIPAL -->
    <main class="w-full max-w-5xl space-y-2"> <!-- Espacio muy reducido entre bloques -->

        <!-- PASO 1: SELECTOR DE MÓDULOS -->
        <div class="grid grid-cols-3 gap-4 md:gap-6 mb-4">
            <button onclick="selectModule('CREDITO')" id="mod-CREDITO" class="module-btn active p-5 rounded-[2rem] bg-white border border-slate-100 flex flex-col items-center gap-3 text-center group">
                <div class="icon-container w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-slate-50 text-brand-navy flex items-center justify-center text-2xl md:text-3xl transition-all duration-300">
                    <i class="fa-solid fa-hand-holding-dollar"></i>
                </div>
                <span class="font-display font-bold text-sm md:text-base text-brand-navy group-hover:text-brand-orange transition-colors">Préstamos</span>
            </button>

            <button onclick="selectModule('AHORRO')" id="mod-AHORRO" class="module-btn p-5 rounded-[2rem] bg-white border border-slate-100 flex flex-col items-center gap-3 text-center group">
                <div class="icon-container w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-slate-50 text-brand-navy flex items-center justify-center text-2xl md:text-3xl transition-all duration-300">
                    <i class="fa-solid fa-piggy-bank"></i>
                </div>
                <span class="font-display font-bold text-sm md:text-base text-brand-navy group-hover:text-brand-orange transition-colors">Ahorro</span>
            </button>

            <button onclick="selectModule('DPF')" id="mod-DPF" class="module-btn p-5 rounded-[2rem] bg-white border border-slate-100 flex flex-col items-center gap-3 text-center group">
                <div class="icon-container w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-slate-50 text-brand-navy flex items-center justify-center text-2xl md:text-3xl transition-all duration-300">
                    <i class="fa-solid fa-vault"></i>
                </div>
                <span class="font-display font-bold text-sm md:text-base text-brand-navy group-hover:text-brand-orange transition-colors">Inversión</span>
            </button>
        </div>

        <!-- PASO 2: SELECTOR DE PRODUCTOS (PILLS CENTRADOS) -->
        <div class="relative animate-slide-down z-20 py-1">
            <!-- Centrado con justify-center -->
            <div id="productsContainer" class="flex gap-3 overflow-x-auto hide-scrollbar p-2 justify-center">
                <!-- Se llena con JS -->
            </div>
        </div>

        <!-- PASO 3: SIMULADOR (TARJETA PRINCIPAL) -->
        <div id="simulatorCard" class="bg-white rounded-[3rem] shadow-floating border border-white p-8 md:p-12 relative overflow-hidden animate-fade-in mt-4">
            
            <!-- Decoración sutil de fondo -->
            <div class="absolute top-0 right-0 w-96 h-96 bg-brand-light rounded-bl-full opacity-50 pointer-events-none"></div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 relative z-10">
                
                <!-- COLUMNA IZQUIERDA: CONTROLES -->
                <div class="lg:col-span-7 space-y-10">
                    
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-12 h-12 rounded-2xl bg-brand-orange text-white flex items-center justify-center shadow-lg shadow-orange-200">
                            <i id="productIcon" class="fa-solid fa-car text-xl"></i>
                        </div>
                        <div>
                            <h2 id="productTitle" class="text-2xl font-display font-bold text-brand-navy">Crédito Vehicular</h2>
                            <p id="productDesc" class="text-sm text-slate-500">Compra tu auto nuevo o usado con las mejores tasas.</p>
                        </div>
                    </div>

                    <!-- Slider Monto -->
                    <div>
                        <div class="flex justify-between items-end mb-5">
                            <label class="font-bold text-brand-navy uppercase text-xs tracking-widest text-opacity-70">Monto Solicitado</label>
                            <div class="flex items-baseline gap-1">
                                <span id="displayMonto" class="text-4xl font-display font-bold text-brand-navy tracking-tight">0</span>
                                <span class="text-lg font-medium text-slate-400">Bs</span>
                            </div>
                        </div>
                        <div class="px-2">
                            <input type="range" id="inputMonto" oninput="calculate()">
                        </div>
                        <div class="flex justify-between text-xs font-semibold text-slate-400 mt-3 px-1">
                            <span id="lblMinMonto">1k</span>
                            <span id="lblMaxMonto">100k</span>
                        </div>
                    </div>

                    <!-- Slider Plazo -->
                    <div>
                        <div class="flex justify-between items-end mb-5">
                            <label class="font-bold text-brand-navy uppercase text-xs tracking-widest text-opacity-70">Plazo</label>
                            <div class="flex items-baseline gap-1">
                                <span id="displayPlazo" class="text-4xl font-display font-bold text-brand-navy tracking-tight">0</span>
                                <span id="unitPlazo" class="text-lg font-medium text-slate-400">meses</span>
                            </div>
                        </div>
                        <div class="px-2">
                            <input type="range" id="inputPlazo" oninput="calculate()">
                        </div>
                        <div class="flex justify-between text-xs font-semibold text-slate-400 mt-3 px-1">
                            <span id="lblMinPlazo">1</span>
                            <span id="lblMaxPlazo">60</span>
                        </div>
                    </div>

                    <!-- Info Requisitos Rápida -->
                    <div class="bg-slate-50 p-5 rounded-2xl flex gap-4 border border-slate-100 items-start">
                        <div class="mt-1 bg-white p-1 rounded-full text-brand-blue shadow-sm"><i class="fa-solid fa-check"></i></div>
                        <div class="text-sm text-brand-navy/80">
                            <span class="font-bold block text-brand-navy text-xs uppercase mb-1">Requisitos Básicos:</span>
                            <p id="requirementsText" class="leading-relaxed font-light">Cedula de identidad, Respaldo de ingresos, Factura de servicios básicos.</p>
                        </div>
                    </div>

                </div>

                <!-- COLUMNA DERECHA: RESULTADOS (Dark Card) -->
                <div class="lg:col-span-5 flex flex-col justify-between bg-brand-navy rounded-[2.5rem] p-10 text-white relative overflow-hidden shadow-2xl shadow-blue-900/20">
                    
                    <!-- Brillo de fondo -->
                    <div class="absolute -top-20 -right-20 w-64 h-64 bg-brand-blue rounded-full blur-3xl opacity-50"></div>
                    <div class="absolute bottom-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cube-coat.png')] opacity-5"></div>

                    <div class="relative z-10 text-center lg:text-left">
                        <p class="text-brand-orange font-bold text-xs uppercase tracking-widest mb-4" id="resultLabel">CUOTA ESTIMADA</p>
                        
                        <div class="flex items-baseline justify-center lg:justify-start gap-2 mb-2">
                            <span id="resultValue" class="text-6xl font-display font-bold tracking-tight">0</span>
                            <span class="text-2xl font-medium text-white/50">Bs</span>
                        </div>
                        <p id="resultSub" class="text-sm text-white/60 mb-8 font-light">Pago mensual aproximado</p>

                        <div class="bg-white/10 rounded-2xl p-4 backdrop-blur-md border border-white/10 mb-4 flex justify-between items-center">
                            <span class="text-sm text-white/80 font-light">Tasa Anual Ref.</span>
                            <span id="rateValue" class="font-bold text-white bg-white/20 px-2 py-1 rounded-lg">0%</span>
                        </div>
                        
                        <div id="capacityWarning" class="hidden bg-red-500/20 border border-red-500/30 p-3 rounded-xl text-xs text-red-100 mt-4 flex gap-2 items-start justify-center lg:justify-start backdrop-blur-sm">
                             <i class="fa-solid fa-triangle-exclamation mt-0.5"></i>
                             <span>Tu cuota excede el 40% de tu ingreso estimado.</span>
                        </div>
                    </div>

                    <div class="mt-8 relative z-10">
                        <button onclick="openLeadModal()" class="w-full py-5 btn-shine text-white font-bold text-lg rounded-2xl shadow-glow transition-all transform hover:-translate-y-1 flex justify-center items-center gap-3 group">
                            <span>ME INTERESA</span>
                            <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                        </button>
                        <p class="text-center text-[10px] text-white/40 mt-4 tracking-wider uppercase">Evaluación sujeta a políticas de crédito</p>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <!-- MODAL POPUP (LEAD FORM) -->
    <div id="leadModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-brand-navy/80 backdrop-blur-md transition-opacity opacity-0" id="modalBackdrop" onclick="closeLeadModal()"></div>
        
        <!-- Modal Content -->
        <div class="relative bg-white w-full max-w-md rounded-3xl shadow-2xl transform scale-95 opacity-0 transition-all duration-300 overflow-hidden" id="modalContent">
            
            <div class="bg-brand-navy p-8 text-white text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cube-coat.png')] opacity-10"></div>
                
                <button onclick="closeLeadModal()" class="absolute top-4 right-4 text-white/50 hover:text-white transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
                
                <div class="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center text-brand-orange text-3xl mx-auto mb-4 backdrop-blur-sm border border-white/20 shadow-inner">
                    <i class="fa-regular fa-paper-plane"></i>
                </div>
                <h3 class="text-2xl font-display font-bold">Solicitar Contacto</h3>
                <p class="text-white/60 text-sm font-light mt-1">Un oficial experto te asesorará.</p>
            </div>

            <div class="p-8">
                <form id="leadForm" onsubmit="event.preventDefault(); submitLead();" class="space-y-5">
                    
                    <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 text-center">
                        <p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest mb-1">INTERÉS EN</p>
                        <p class="font-bold text-brand-navy text-lg" id="modalSummary">...</p>
                    </div>

                    <div class="space-y-4">
                        <div class="relative">
                            <i class="fa-regular fa-user absolute left-4 top-4 text-slate-400"></i>
                            <input type="text" required class="w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20 outline-none transition-all placeholder-slate-300 text-brand-navy font-medium" placeholder="Nombre Completo">
                        </div>
                        <div class="relative">
                            <i class="fa-solid fa-mobile-screen absolute left-4 top-4 text-slate-400"></i>
                            <input type="tel" required class="w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20 outline-none transition-all placeholder-slate-300 text-brand-navy font-medium" placeholder="Celular / WhatsApp">
                        </div>
                        
                        <!-- Ingreso para validar 40% -->
                        <div id="incomeInputGroup" class="relative">
                            <i class="fa-solid fa-wallet absolute left-4 top-4 text-slate-400"></i>
                            <input type="number" id="modalIngreso" required oninput="checkCapacity()" class="w-full pl-12 pr-12 py-3 bg-white border border-slate-200 rounded-xl focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20 outline-none transition-all placeholder-slate-300 text-brand-navy font-bold" placeholder="Ingreso Mensual">
                            <span class="absolute right-4 top-4 text-xs font-bold text-slate-400">Bs</span>
                        </div>
                        <p id="capacityMsg" class="text-xs text-red-500 mt-1 hidden text-center bg-red-50 p-2 rounded-lg border border-red-100"><i class="fa-solid fa-circle-exclamation mr-1"></i> Ingreso insuficiente para la cuota calculada.</p>
                    </div>

                    <button type="submit" id="btnSubmit" class="w-full py-4 bg-brand-navy hover:bg-brand-blue text-white font-bold rounded-xl shadow-lg transition-all mt-4">
                        ENVIAR SOLICITUD
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- DATA & LOGIC ENGINE -->
    <script>
        // BASE DE DATOS ACTUALIZADA V25.1
        const DATA = {
            CREDITO: [
                { id: 'c_quiro', icon: 'fa-signature', name: 'Consumo Simple', desc: 'Sin garantía real. Firma personal.', min: 14000, max: 210000, minP: 1, maxP: 48, unit: 'meses', req: 'Carnet de Identidad, 3 últimas boletas de pago, Factura de luz.', tasas: 0.18 },
                { id: 'c_personal', icon: 'fa-user-group', name: 'Con Garante', desc: 'Mejores condiciones con garante.', min: 14000, max: 210000, minP: 1, maxP: 60, unit: 'meses', req: 'CI solicitante y garante, Respaldo patrimonial garante.', tasas: 0.17 },
                { id: 'c_vehicular', icon: 'fa-car', name: 'Vehicular', desc: 'Auto nuevo o usado.', min: 35000, max: 350000, minP: 12, maxP: 60, unit: 'meses', req: 'Proforma del vehículo, Aporte propio 10-20%.', tasas: 0.125 },
                { id: 'c_vivienda', icon: 'fa-house-chimney', name: 'Vivienda', desc: 'Compra, construcción o mejora.', min: 140000, max: 3500000, minP: 60, maxP: 240, unit: 'meses', req: 'Avalúo del inmueble, Aporte propio 20%.', tasas: 0.10 }
            ],
            AHORRO: [
                { id: 'a_agil', icon: 'fa-bolt', name: 'Fortaleza Ágil', desc: 'Tu dinero siempre disponible.', min: 1000, max: 1000000, minP: 1, maxP: 60, unit: 'meses', req: 'Solo CI vigente y monto de apertura.', tasas: 0.0425, isGain: true },
                { id: 'a_crece', icon: 'fa-chart-line', name: 'Fortaleza Crece', desc: 'Gana más ahorrando más.', min: 5000, max: 1000000, minP: 1, maxP: 60, unit: 'meses', req: 'CI vigente, Monto apertura 5k.', tasas: 0.045, isGain: true }
            ],
            DPF: [
                { id: 'dpf_promo', icon: 'fa-certificate', name: 'DPF Promo', desc: 'Máxima rentabilidad a plazo.', min: 1000, max: 500000, minP: 180, maxP: 1440, unit: 'días', req: 'CI vigente. Tasas promocionales 2025.', tasas: 0.06, isGain: true }
            ]
        };

        let currentModule = 'CREDITO';
        let currentProd = DATA.CREDITO[0];
        let currentCalculatedValue = 0; // Cuota o Ganancia

        const money = new Intl.NumberFormat('es-BO', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

        // INICIALIZAR
        window.onload = () => {
            selectModule('CREDITO');
        };

        function selectModule(mod) {
            currentModule = mod;
            
            // Actualizar Botones Módulo
            document.querySelectorAll('.module-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`mod-${mod}`).classList.add('active');

            // Renderizar Pills de Productos
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';
            
            DATA[mod].forEach((prod, index) => {
                const btn = document.createElement('button');
                btn.className = `product-pill flex-shrink-0 px-6 py-2 rounded-full font-medium text-sm text-brand-navy bg-white shadow-sm flex items-center gap-2 ${index === 0 ? 'active' : ''}`;
                btn.onclick = () => selectProduct(prod, btn);
                btn.innerHTML = `<i class="fa-solid ${prod.icon}"></i> ${prod.name}`;
                container.appendChild(btn);
            });

            // Seleccionar el primero por defecto
            selectProduct(DATA[mod][0]);
        }

        function selectProduct(prod, btnElement = null) {
            currentProd = prod;
            
            // Estilos de Pills
            if(btnElement) {
                document.querySelectorAll('.product-pill').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');
            } else {
                // Si viene de selectModule, buscamos el primero
                const firstBtn = document.querySelector('.product-pill');
                if(firstBtn) firstBtn.classList.add('active');
            }

            // Actualizar UI Simulador
            document.getElementById('productTitle').textContent = prod.name;
            document.getElementById('productDesc').textContent = prod.desc;
            document.getElementById('productIcon').className = `fa-solid ${prod.icon} text-xl`;
            document.getElementById('requirementsText').textContent = prod.req;
            document.getElementById('rateValue').textContent = (prod.tasas * 100).toFixed(2) + '% Anual';

            // Configurar Sliders
            const slMonto = document.getElementById('inputMonto');
            slMonto.min = prod.min; slMonto.max = prod.max; slMonto.value = prod.min;
            document.getElementById('lblMinMonto').textContent = abbreviate(prod.min);
            document.getElementById('lblMaxMonto').textContent = abbreviate(prod.max);

            const slPlazo = document.getElementById('inputPlazo');
            slPlazo.min = prod.minP; slPlazo.max = prod.maxP; slPlazo.value = prod.minP;
            document.getElementById('lblMinPlazo').textContent = prod.minP;
            document.getElementById('lblMaxPlazo').textContent = prod.maxP;
            document.getElementById('unitPlazo').textContent = prod.unit;

            // Ajustar Labels de Resultado
            const resLabel = document.getElementById('resultLabel');
            const resSub = document.getElementById('resultSub');
            const incomeInput = document.getElementById('incomeInputGroup');

            if (prod.isGain) {
                resLabel.textContent = "GANANCIA TOTAL ESTIMADA";
                resSub.textContent = "Al finalizar el periodo";
                incomeInput.classList.add('hidden'); // No necesitamos ingreso para ahorro
                document.getElementById('modalIngreso').removeAttribute('required');
            } else {
                resLabel.textContent = "CUOTA MENSUAL ESTIMADA";
                resSub.textContent = "Mensual aprox.";
                incomeInput.classList.remove('hidden');
                document.getElementById('modalIngreso').setAttribute('required', 'true');
            }

            calculate();
        }

        function calculate() {
            const monto = parseFloat(document.getElementById('inputMonto').value);
            const plazo = parseFloat(document.getElementById('inputPlazo').value);
            const tasa = currentProd.tasas;

            document.getElementById('displayMonto').textContent = money.format(monto);
            document.getElementById('displayPlazo').textContent = plazo;

            let result = 0;

            if (currentProd.isGain) {
                // Lógica Ganancia (DPF o Ahorro)
                if (currentModule === 'DPF') {
                    // Interés Simple: C * i * t/360
                    result = monto * tasa * (plazo / 360);
                } else {
                    // Ahorro (Compuesto Mensual Referencial)
                    // VF = VP * (1 + i/12)^n
                    const vf = monto * Math.pow(1 + tasa/12, plazo);
                    result = vf - monto;
                }
            } else {
                // Lógica Crédito (Francesa)
                // Cuota = C * (i * (1+i)^n) / ((1+i)^n - 1)
                const i = tasa / 12;
                result = monto * (i * Math.pow(1+i, plazo)) / (Math.pow(1+i, plazo) - 1);
            }

            currentCalculatedValue = result;
            
            // Animación de conteo simple
            document.getElementById('resultValue').textContent = money.format(result);
        }

        // --- LEAD MODAL ---
        function openLeadModal() {
            const modal = document.getElementById('leadModal');
            const backdrop = document.getElementById('modalBackdrop');
            const content = document.getElementById('modalContent');
            
            // Setear resumen
            const monto = document.getElementById('inputMonto').value;
            document.getElementById('modalSummary').textContent = `${currentProd.name} por ${money.format(monto)} Bs`;

            modal.classList.remove('hidden');
            setTimeout(() => {
                backdrop.classList.remove('opacity-0');
                content.classList.remove('opacity-0', 'scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

        function closeLeadModal() {
            const modal = document.getElementById('leadModal');
            const backdrop = document.getElementById('modalBackdrop');
            const content = document.getElementById('modalContent');
            
            backdrop.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('opacity-0', 'scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function checkCapacity() {
            // Validar 40% capacidad
            if(currentProd.isGain) return; // No aplica para ahorro

            const ingreso = parseFloat(document.getElementById('modalIngreso').value) || 0;
            const capacidad = ingreso * 0.40;
            const msg = document.getElementById('capacityMsg');

            if (ingreso > 0 && currentCalculatedValue > capacidad) {
                msg.classList.remove('hidden');
            } else {
                msg.classList.add('hidden');
            }
        }

        function submitLead() {
            const btn = document.getElementById('btnSubmit');
            const originalHTML = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Enviando...';
            btn.classList.add('opacity-75');

            // Simulación AJAX
            setTimeout(() => {
                alert(`¡Gracias! Hemos recibido tu solicitud para ${currentProd.name}.`);
                closeLeadModal();
                btn.innerHTML = originalHTML;
                btn.disabled = false;
                btn.classList.remove('opacity-75');
                document.getElementById('leadForm').reset();
            }, 1500);
        }

        function abbreviate(num) {
            if (num >= 1000000) return (num/1000000) + 'M';
            if (num >= 1000) return (num/1000) + 'k';
            return num;
        }

    </script>
</body>
</html>
